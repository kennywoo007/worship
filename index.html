<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NewSong Worship V8.5 - 移动优化版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;600;900&display=swap');
        body { font-family: 'Noto Serif SC', serif; background-color: #050505; color: #fff; overflow: hidden; height: 100vh; width: 100vw; display: flex; flex-direction: row; }
        
        .sidebar-dark { background-color: #000; border-right: 1px solid #1a1a1a; width: 208px; flex-shrink: 0; display: flex; flex-direction: column; z-index: 50; }
        .main-content { flex: 1; position: relative; overflow: hidden; display: flex; flex-direction: column; height: 100vh; }
        
        .nav-link { color: #d1d5db; transition: all 0.3s ease; cursor: pointer; text-align: left; }
        .nav-link:hover { color: #ffffff; transform: translateX(4px); }
        .nav-link.active { color: #f97316; font-weight: 600; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .vignette { background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.7) 100%); }
        @keyframes imageBloom { 0% { filter: grayscale(0.5) brightness(0.6); transform: scale(1.08); } 100% { filter: grayscale(0) brightness(1); transform: scale(1); } }
        .animate-bloom { animation: imageBloom 4s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        @keyframes textFadeUp { 0% { opacity: 0; transform: translateY(20px); } 100% { opacity: 1; transform: translateY(0); } }
        .fade-up { opacity: 0; }
        .do-fade-up { animation: textFadeUp 1.5s ease-out forwards; }
        .delay-1 { animation-delay: 0.5s; }
        .delay-2 { animation-delay: 1.5s; }
        .delay-3 { animation-delay: 2.5s; }

        .history-split { display: flex; height: 100%; overflow: hidden; }
        .history-player-panel { width: 350px; border-right: 1px solid rgba(255,255,255,0.05); padding: 2rem; display: flex; flex-direction: column; justify-content: center; }
        .history-list-panel { flex: 1; overflow-y: auto; padding: 2rem; padding-bottom: 150px; }
        .weekly-track-item { background: rgba(255,255,255,0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.05); transition: all 0.3s ease; }
        
        input[type="range"] { -webkit-appearance: none; background: rgba(255,255,255,0.1); border-radius: 5px; height: 4px; cursor: pointer; background-image: linear-gradient(#f97316, #f97316); background-repeat: no-repeat; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; height: 14px; width: 14px; background: #f97316; border-radius: 50%; border: 2px solid #fff; }
        .admin-panel { background: #0a0a0a; border-radius: 20px; border: 1px solid #262626; }

        /* 手机端适配逻辑 */
        @media (max-width: 768px) {
            body { flex-direction: column; }
            .sidebar-dark { width: 100%; height: auto; border-right: none; border-bottom: 1px solid #1a1a1a; flex-direction: row; overflow-x: auto; padding: 8px; flex-shrink: 0; }
            .sidebar-logo, .sidebar-tag, .admin-entry-pc { display: none !important; }
            .sidebar-nav { display: flex; flex-direction: row; gap: 8px; white-space: nowrap; width: auto; padding: 0 5px; }
            .nav-link { flex-shrink: 0; padding: 6px 12px !important; font-size: 13px; display: flex; align-items: center; gap: 4px; border-radius: 999px; background: rgba(255,255,255,0.05); }
            .nav-link.active { background: rgba(249, 115, 22, 0.2); }
            
            /* 内容区适配：确保底部留出 footer 的空间 */
            .main-content { height: auto; flex: 1; overflow: hidden; }
            #display-title { font-size: 2.2rem !important; margin-bottom: 1rem; line-height: 1.2; }
            .history-split { flex-direction: column; overflow-y: auto; }
            .history-player-panel { width: 100%; height: auto; padding: 1rem; border-right: none; border-bottom: 1px solid rgba(255,255,255,0.1); }
            
            /* 强制控制栏显示在手机最底端 */
            footer { height: 100px; flex-shrink: 0; padding-bottom: env(safe-area-inset-bottom); border-top: 1px solid rgba(255,255,255,0.1); background: #000; }
            .px-10, .md\:px-24 { padding-left: 1.2rem !important; padding-right: 1.2rem !important; }
        }
    </style>
</head>
<body class="no-scrollbar">

    <aside class="sidebar-dark no-scrollbar text-left">
        <div class="p-6 sidebar-logo"><img src="GXlogo.png" alt="LOGO" class="w-full object-contain"></div>
        <nav class="sidebar-nav space-y-1 p-2 md:p-6 flex-1">
            <button onclick="showPage('home')" id="nav-home" class="nav-link w-full flex items-center gap-3 px-4 py-3 text-sm rounded-lg active"><i data-lucide="home" class="w-4 h-4"></i><span>预习曲目</span></button>
            <button onclick="showPage('history')" id="nav-history" class="nav-link w-full flex items-center gap-3 px-4 py-3 text-sm rounded-lg"><i data-lucide="history" class="w-4 h-4"></i><span>历史曲库</span></button>
            <button onclick="showPage('donate')" id="nav-donate" class="nav-link w-full flex items-center gap-3 px-4 py-3 text-sm rounded-lg"><i data-lucide="heart-handshake" class="w-4 h-4"></i><span>甘心奉献</span></button>
            <div class="pt-6 pb-2 px-4 text-[10px] text-zinc-500 font-bold uppercase tracking-widest sidebar-tag">事工安排</div>
            <button class="nav-link w-full flex items-center gap-3 px-4 py-3 text-sm rounded-lg sidebar-tag"><i data-lucide="calendar" class="w-4 h-4"></i><span>近期活动</span></button>
            <button class="nav-link w-full flex items-center gap-3 px-4 py-3 text-sm rounded-lg sidebar-tag"><i data-lucide="users-round" class="w-4 h-4"></i><span>门训事工</span></button>
            <button class="nav-link w-full flex items-center gap-3 px-4 py-3 text-sm rounded-lg sidebar-tag"><i data-lucide="calendar" class="w-4 h-4"></i><span>代祷事项</span></button>
        </nav>
        <div class="mt-auto p-6 border-t border-white/5 admin-entry-pc hidden md:block">
            <button onclick="openAdminModal()" class="w-full flex justify-between items-center text-zinc-500 hover:text-orange-500 transition-colors">
                <div class="flex items-center gap-3"><i data-lucide="settings" class="w-4 h-4"></i><span class="text-sm">曲目编辑</span></div>
                <i data-lucide="lock" class="w-3 h-3 opacity-50"></i>
            </button>
        </div>
    </aside>

    <main class="main-content">
        <div id="page-home" class="absolute inset-0 transition-opacity duration-700 block overflow-y-auto no-scrollbar">
            <div class="fixed inset-0 bg-[url('https://images.unsplash.com/photo-1438232992991-995b7058bbb3?auto=format&fit=crop&q=80&w=2070')] bg-cover bg-center"></div>
            <div class="fixed inset-0 vignette"></div>
            <div class="relative min-h-full flex flex-col justify-center px-10 md:px-24 py-20 md:py-32 text-left">
                <h4 class="text-orange-500 font-bold tracking-[0.4em] text-[10px] md:text-sm mb-4">WEEKLY PRACTICE</h4>
                <h2 id="display-title" class="text-3xl md:text-8xl font-black mb-8 md:mb-10 tracking-tighter text-white">等待开启...</h2>
                <div class="w-fit">
                    <div class="flex items-center gap-3 md:gap-6 mb-12 md:mb-16">
                        <button onclick="startWeeklyPlay()" class="flex items-center gap-3 px-6 py-4 md:px-12 md:py-5 bg-orange-600 hover:bg-orange-700 rounded-full transition-all shadow-2xl flex-shrink-0 text-white"><i data-lucide="play-circle" class="w-5 h-5 md:w-6 md:h-6"></i><span class="text-sm md:text-lg font-bold uppercase">立即播放</span></button>
                        <button onclick="showCurrentSheet()" class="flex items-center gap-2 px-6 py-4 md:px-8 md:py-5 bg-white/10 hover:bg-white/20 border border-white/10 rounded-full backdrop-blur-xl transition-all flex-shrink-0 text-white"><i data-lucide="file-text" class="w-4 h-4 md:w-5 md:h-5 text-orange-500"></i><span class="text-sm md:text-lg font-bold uppercase">查看简谱</span></button>
                    </div>
                    <div class="w-full text-left">
                        <div class="flex items-center gap-3 mb-6"><span class="h-px w-6 md:w-8 bg-orange-500"></span><h5 class="text-zinc-200 text-[10px] md:text-xs font-bold tracking-widest uppercase">本周待练清单</h5></div>
                        <div id="home-weekly-tracks" class="space-y-3"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-history" class="absolute inset-0 bg-[#050505] z-30 translate-y-full transition-transform duration-700 overflow-hidden">
            <div class="history-split h-full">
                <div class="history-player-panel bg-zinc-950/50 text-left">
                    <h4 class="text-orange-500 font-bold tracking-widest text-[10px] mb-4 uppercase">Now Selecting</h4>
                    <div class="space-y-2 mb-6">
                        <h2 id="hist-playing-title" class="text-2xl md:text-4xl font-black leading-tight text-white">未在点播</h2>
                        <p id="hist-playing-artist" class="text-zinc-500 text-sm italic">选择下方歌曲开始敬拜</p>
                    </div>
                    <button onclick="showCurrentSheet()" class="w-full py-6 md:py-20 border border-dashed border-zinc-800 rounded-2xl group hover:border-orange-500/50 hover:bg-orange-500/5 transition-all text-white">
                        <i data-lucide="file-text" class="w-8 h-8 md:w-12 md:h-12 text-zinc-700 group-hover:text-orange-500 mx-auto mb-2"></i>
                        <span class="block text-xs text-zinc-500 group-hover:text-white font-bold">查看当前简谱</span>
                    </button>
                </div>
                <div class="history-list-panel no-scrollbar text-left">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-10 gap-4">
                        <h2 class="text-3xl md:text-5xl font-black italic tracking-tighter text-white">历史曲库</h2>
                        <input type="text" id="history-search" oninput="renderHistory()" placeholder="搜索..." class="bg-zinc-900 border border-white/5 rounded-full py-2 md:py-3 px-6 text-sm w-full md:w-64 outline-none focus:border-orange-500 text-white">
                    </div>
                    <div id="history-sections" class="space-y-16"></div>
                </div>
            </div>
        </div>

        <div id="page-donate" class="absolute inset-0 bg-[#050505] z-30 translate-y-full transition-transform duration-700 overflow-y-auto flex flex-col items-center justify-center p-6 md:p-24 no-scrollbar">
            <div class="max-w-3xl text-center space-y-10 text-white">
                <div class="relative w-full h-56 md:h-80 overflow-hidden rounded-3xl shadow-2xl border border-white/5">
                    <img id="donate-img" src="giving.png" onerror="this.src='https://images.unsplash.com/photo-1515162305285-0293e4767cc2?q=80&w=2070'" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"></div>
                </div>
                <div class="space-y-8">
                    <h3 id="donate-tag" class="fade-up text-orange-500 font-bold tracking-[0.3em] text-[10px] md:text-xs italic uppercase">甘心奉献 · 神所喜悦</h3>
                    <p id="donate-verse-1" class="fade-up delay-1 text-lg md:text-3xl leading-relaxed font-light italic">“少种的少收，多种的多收”，这话是真的。各人要随本心所酌定的，不要作难，不要勉强，因为捐得乐意的人是　神所喜爱的。</p>
                    <div id="donate-verse-2" class="fade-up delay-2 space-y-4 md:space-y-6">
                        <p class="text-sm md:text-xl text-zinc-400">神能将各样的恩惠多多地加给你们，使你们凡事常常充足，能多行各样善事。</p>
                        <p class="text-orange-500/60 font-mono text-[10px] md:text-xs uppercase tracking-[0.5em]">哥林多后书 9:6-8</p>
                    </div>
                    <div id="donate-footer" class="fade-up delay-3 pt-4">
                        <button onclick="showPage('home')" class="px-10 py-3 md:px-10 md:py-4 bg-zinc-900 border border-white/10 rounded-full text-xs hover:bg-white hover:text-black transition-all uppercase tracking-widest text-white">返回首页</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-admin" class="absolute inset-0 bg-zinc-950 z-40 translate-x-full transition-transform duration-500 p-6 md:p-16 overflow-y-auto no-scrollbar">
            <div class="flex justify-between items-center mb-8 md:mb-12">
                <h2 class="text-xl md:text-2xl font-bold italic text-white text-left">资源管理中心</h2>
                <button onclick="showPage('home')" class="px-5 py-2 bg-zinc-800 rounded-full text-[10px] md:text-xs text-white">返回首页</button>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
                <div class="admin-panel p-6 md:p-8 bg-black">
                    <h3 id="admin-form-title" class="text-lg font-bold mb-6 text-orange-500 text-left">入库新曲目</h3>
                    <div class="space-y-4">
                        <input id="input-title" type="text" placeholder="歌曲名" class="w-full bg-zinc-900 border border-zinc-800 rounded-lg p-3 text-sm text-white outline-none">
                        <input id="input-artist" type="text" placeholder="艺术家" class="w-full bg-zinc-900 border border-zinc-800 rounded-lg p-3 text-sm text-white outline-none">
                        <input id="input-sheet" type="text" placeholder="简谱链接" class="w-full bg-zinc-900 border border-zinc-800 rounded-lg p-3 text-sm text-white outline-none">
                        <input id="input-audio" type="text" placeholder="音频链接" class="w-full bg-zinc-900 border border-zinc-800 rounded-lg p-3 text-sm text-white outline-none">
                        <div class="flex gap-2">
                            <button id="save-btn" onclick="addNewSongToLibrary()" class="flex-1 py-4 bg-orange-600 rounded-lg font-bold text-white hover:bg-orange-500">确认保存</button>
                            <button id="cancel-edit-btn" onclick="resetAdminForm()" class="hidden px-4 bg-zinc-800 rounded-lg text-zinc-400"><i data-lucide="x"></i></button>
                        </div>
                    </div>
                </div>
                <div class="admin-panel p-6 md:p-8 lg:col-span-2">
                    <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                        <h3 class="text-lg font-bold text-zinc-400 italic text-left w-full">总库清单 (点击设置本周)</h3>
                        <div class="relative w-full md:w-64">
                            <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-500"></i>
                            <input type="text" id="admin-search" oninput="renderAdminInventory()" placeholder="搜索..." class="w-full bg-zinc-900 border border-white/5 rounded-full py-2 pl-12 pr-6 text-xs text-white outline-none focus:border-orange-500 transition-all">
                        </div>
                    </div>
                    <div id="admin-inventory-list" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-[400px] md:max-h-[500px] overflow-y-auto pr-2 no-scrollbar text-white"></div>
                </div>
            </div>
        </div>

        <footer class="mt-auto h-24 md:h-28 bg-black/95 backdrop-blur-3xl border-t border-white/5 flex flex-col justify-center px-4 md:px-10 z-[60]">
            <div class="w-full flex items-center gap-3 md:gap-4 mb-2">
                <span id="curr-time" class="text-[9px] md:text-[10px] text-zinc-500 font-mono">00:00</span>
                <input id="progress-bar" type="range" class="flex-1" min="0" max="100" value="0">
                <span id="total-time" class="text-[9px] md:text-[10px] text-zinc-500 font-mono">00:00</span>
            </div>
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4 w-1/4"><div class="truncate text-xs md:text-sm font-bold text-white text-left" id="play-bar-title">未在播放</div></div>
                <div class="flex items-center gap-4 md:gap-6">
                    <button onclick="toggleShuffle()" id="shuffle-btn" class="text-zinc-600 transition-colors" title="随机"><i data-lucide="shuffle" class="w-4 h-4"></i></button>
                    <button onclick="prevSong()" class="text-white hover:text-orange-500" title="回溯"><i data-lucide="skip-back" class="w-5 h-5"></i></button>
                    <button id="main-play-btn" onclick="togglePlay()" class="w-10 h-10 md:w-12 md:h-12 bg-white text-black rounded-full flex items-center justify-center shadow-lg transition-transform hover:scale-110"><i data-lucide="play" class="w-5 h-5 md:w-6 md:h-6"></i></button>
                    <button onclick="nextSong()" class="text-white hover:text-orange-500"><i data-lucide="skip-forward" class="w-5 h-5"></i></button>
                </div>
                <div class="w-1/4 flex justify-end"><input type="range" id="volume-control" class="w-20 hidden md:block" min="0" max="1" step="0.1" value="0.8"></div>
            </div>
        </footer>
    </main>

    <div id="admin-modal" class="fixed inset-0 z-[110] hidden flex items-center justify-center bg-black/95 text-white p-6">
        <div class="w-full max-w-xs bg-zinc-900 p-8 rounded-3xl border border-white/10 text-center shadow-2xl">
            <i data-lucide="lock" class="w-10 h-10 text-orange-500 mx-auto mb-4"></i>
            <h3 class="text-xl font-bold mb-6">安全验证</h3>
            <input id="admin-password" type="password" placeholder="输入密码" class="w-full bg-black border border-zinc-800 rounded-xl p-4 mb-6 text-center text-white outline-none">
            <div class="flex gap-3">
                <button onclick="closeAdminModal()" class="flex-1 py-3 bg-zinc-800 rounded-xl font-bold text-zinc-400">返回</button>
                <button onclick="checkPassword()" class="flex-1 py-3 bg-orange-600 rounded-xl font-bold">进入</button>
            </div>
        </div>
    </div>

    <div id="sheet-modal" class="fixed inset-0 z-[200] hidden flex flex-col items-center justify-center bg-black/90 p-4 md:p-10 text-white">
        <button onclick="closeSheetModal()" class="absolute top-6 right-6 text-white/50 hover:text-white"><i data-lucide="x-circle" class="w-8 h-8"></i></button>
        <div class="w-full h-full flex items-center justify-center"><img id="modal-sheet-img" src="" class="max-w-full max-h-full object-contain rounded-lg shadow-2xl"></div>
    </div>

    <script>
        // --- 核心固化数据库保持（62 首） ---
        let allSongs = JSON.parse(localStorage.getItem('worshipLibrary')) || [
            {"id": 1, "title": "耶稣 耶稣 （赞美之泉）", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://11.400400.icu:9003/api/download/image?id=132599&timestamp=509538429&code=4470", "audio": "https://11.400400.icu:9003/api/download/music?id=86892&timestamp=509538437&code=4df6"},
            {"id": 2, "title": "满有能力", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://11.400400.icu:9003/api/download/image?id=29493&timestamp=509537613&code=87ca", "audio": "https://11.400400.icu:9003/api/download/music?id=12811&timestamp=509537923&code=379d"},
            {"id": 3, "title": "每一天我需要你", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://r2-gxsongpic.831017.xyz/sheets/1756523372443_IMG_8321.jpeg", "audio": "https://23.400400.icu:9003/api/download/music?id=52047&timestamp=494247821&code=f3cd"},
            {"id": 4, "title": "荣耀的呼召", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://r2-gxsongpic.831017.xyz/sheets/1756654275615-fsgqvk25-3139_________.jpg", "audio": "https://21.400400.icu:9003/api/download/music?id=76091&timestamp=494247794&code=2564"},
            {"id": 5, "title": "荣耀 荣耀 荣耀", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://23.400400.icu:9003/api/download/image?id=119100&timestamp=494767839&code=fd70", "audio": "https://23.400400.icu:9003/api/download/music?id=75957&timestamp=494767861&code=012e"},
            {"id": 6, "title": "安静", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://32.400400.icu:9003/api/download/image?id=39906&timestamp=494767893&code=eacf", "audio": "https://32.400400.icu:9003/api/download/music?id=21168&timestamp=494767906&code=6b95"},
            {"id": 7, "title": "你永远如此深爱着我", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://23.400400.icu:9003/api/download/image?id=119256&timestamp=494767933&code=c1dc", "audio": "https://23.400400.icu:9003/api/download/music?id=76119&timestamp=494767956&code=7e6d"},
            {"id": 8, "title": "生命路上歌", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://11.400400.icu:9003/api/download/image?id=126625&timestamp=494937058&code=0f2f", "audio": "https://11.400400.icu:9003/api/download/music?id=81088&timestamp=494937192&code=509d"},
            {"id": 9, "title": "在你没有难成的事", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://33.400400.icu:9003/api/download/image?id=119079&timestamp=496009616&code=4f90", "audio": "https://33.400400.icu:9003/api/download/music?id=75909&timestamp=496009631&code=6355"},
            {"id": 10, "title": "我的生命献给你", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://33.400400.icu:9003/api/download/image?id=119267&timestamp=496009647&code=1643", "audio": "https://33.400400.icu:9003/api/download/music?id=76130&timestamp=496009660&code=8793"},
            {"id": 11, "title": "荣耀至高神", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://35.400400.icu:9003/api/download/image?id=118611&timestamp=496008203&code=9a13", "audio": "https://35.400400.icu:9003/api/download/music?id=74812&timestamp=496008218&code=8b3f"},
            {"id": 12, "title": "握手", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://23.400400.icu:9003/api/download/image?id=26994&timestamp=497168422&code=ae77", "audio": "https://23.400400.icu:9003/api/download/music?id=9492&timestamp=497168431&code=f5b6"},
            {"id": 13, "title": "在这些仅存的年间", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://33.400400.icu:9003/api/download/image?id=21635&timestamp=497168394&code=0202", "audio": "https://33.400400.icu:9003/api/download/music?id=9020&timestamp=497168404&code=ac01"},
            {"id": 14, "title": "有一位救主", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://23.400400.icu:9003/api/download/image?id=27239&timestamp=497168370&code=5321", "audio": "https://23.400400.icu:9003/api/download/music?id=9602&timestamp=497168379&code=021f"},
            {"id": 15, "title": "我在这里", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://23.400400.icu:9003/api/download/image?id=115808&timestamp=497168049&code=0af3", "audio": "https://23.400400.icu:9003/api/download/music?id=74770&timestamp=497168060&code=fe75"},
            {"id": 16, "title": "十架的爱", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://33.400400.icu:9003/api/download/image?id=132633&timestamp=497168101&code=aa55", "audio": "https://33.400400.icu:9003/api/download/music?id=86965&timestamp=497168110&code=51ca"},
            {"id": 17, "title": "耶稣爱你", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://33.400400.icu:9003/api/download/image?id=86633&timestamp=497168213&code=dbf8", "audio": "https://33.400400.icu:9003/api/download/music?id=51833&timestamp=497168225&code=8c98"},
            {"id": 18, "title": "展开清晨的翅膀", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://33.400400.icu:9003/api/download/image?id=27329&timestamp=497168018&code=d0a2", "audio": "https://33.400400.icu:9003/api/download/music?id=9645&timestamp=497168028&code=cde7"},
            {"id": 19, "title": "你宝血为我而流", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://23.400400.icu:9003/api/download/image?id=121987&timestamp=497873351&code=941e", "audio": "https://23.400400.icu:9003/api/download/music?id=77824&timestamp=497873363&code=cfb8"},
            {"id": 20, "title": "我知所信歌", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://23.400400.icu:9003/api/download/image?id=30267&timestamp=497873255&code=ec7b", "audio": "https://23.400400.icu:9003/api/download/music?id=6147&timestamp=497873307&code=5b91"},
            {"id": 21, "title": "我在这里", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://23.400400.icu:9003/api/download/image?id=115808&timestamp=497873480&code=d548", "audio": "https://23.400400.icu:9003/api/download/music?id=74770&timestamp=497873494&code=1880"},
            {"id": 22, "title": "你的恩典够我用", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://33.400400.icu:9003/api/download/image?id=86945&timestamp=497873711&code=87d2", "audio": "https://33.400400.icu:9003/api/download/music?id=51893&timestamp=497873724&code=7be6"},
            {"id": 23, "title": "在你没有难成的事", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://33.400400.icu:9003/api/download/image?id=119079&timestamp=497873742&code=7e08", "audio": "https://33.400400.icu:9003/api/download/music?id=75909&timestamp=497873753&code=8cb7"},
            {"id": 24, "title": "不可忘记主恩", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://23.400400.icu:9003/api/download/image?id=27330&timestamp=499124483&code=66bf", "audio": "https://23.400400.icu:9003/api/download/music?id=9646&timestamp=499124494&code=9cd7"},
            {"id": 25, "title": "十字架已成就", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://33.400400.icu:9003/api/download/image?id=117481&timestamp=499124304&code=c4ac", "audio": "https://33.400400.icu:9003/api/download/music?id=73284&timestamp=499124332&code=3a51"},
            {"id": 26, "title": "你真配得赞美", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://34.400400.icu:9003/api/download/image?id=3631&timestamp=499124239&code=531c", "audio": "https://34.400400.icu:9003/api/download/music?id=13100&timestamp=499124258&code=7480"},
            {"id": 27, "title": "唯独依靠你", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://23.400400.icu:9003/api/download/image?id=130993&timestamp=499125487&code=cf20", "audio": "https://23.400400.icu:9003/api/download/music?id=84686&timestamp=499125498&code=c6b4"},
            {"id": 28, "title": "你永远如此深爱着我", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://34.400400.icu:9003/api/download/image?id=119255&timestamp=499774801&code=6b97", "audio": "https://34.400400.icu:9003/api/download/music?id=76118&timestamp=499774815&code=1fb5"},
            {"id": 29, "title": "永活盼望", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://23.400400.icu:9003/api/download/image?id=119652&timestamp=499125070&code=c7b2", "audio": "https://23.400400.icu:9003/api/download/music?id=76570&timestamp=499125080&code=f6da"},
            {"id": 30, "title": "深深爱你", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://31.400400.icu:9003/api/download/image?id=5135&timestamp=499774685&code=c116", "audio": "https://31.400400.icu:9003/api/download/music?id=15083&timestamp=499774765&code=45fb"},
            {"id": 31, "title": "陪我走过春夏秋冬", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://r2-gxsongpic.831017.xyz/sheets/1763799625369-joobnuer-_____2025-11-22_162010_467.jpg", "audio": "https://res.wx.qq.com/voice/getvoice?mediaid=Mzk4ODcxMjkwOF8yMjQ3NDgzOTMz"},
            {"id": 32, "title": "好喜欢与你在一起", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://r2-gxsongpic.831017.xyz/sheets/1763799613503-fjnw2wr1-_____2025-11-22_161954_547.jpg", "audio": "https://res.wx.qq.com/voice/getvoice?mediaid=MzUzMjc3NzQ5NF8yMjQ3NDg0OTM1"},
            {"id": 33, "title": "恩典之路", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://r2-gxsongpic.831017.xyz/sheets/1763799536827-jh3v58zf-_____2025-11-22_161810_455.jpg", "audio": "https://res.wx.qq.com/voice/getvoice?mediaid=MzA4MjcxOTUxNV8yMjQ3NDg8NjYw"},
            {"id": 34, "title": "因你与我同行", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://31.400400.icu:9003/api/download/image?id=89967&timestamp=501524061&code=6768", "audio": "https://31.400400.icu:9003/api/download/music?id=57842&timestamp=501524070&code=57b7"},
            {"id": 35, "title": "圣洁到永远", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://r2-gxsongpic.831017.xyz/sheets/1763799399691-vnzvbu3f-_____20251122161604_45_275.png", "audio": "https://res.wx.qq.com/voice/getvoice?mediaid=Mzk0OTU5ODE2MV8yMjQ3NDg8NDI2"},
            {"id": 36, "title": "我的心你要称颂耶和华", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://23.400400.icu:9003/api/download/image?id=113664&timestamp=501523982&code=8628", "audio": "https://23.400400.icu:9003/api/download/music?id=12806&timestamp=501523995&code=151b"},
            {"id": 37, "title": "深不见底的爱", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://r2-gxsongpic.831017.xyz/sheets/1765032898472-ajr8lnxv-_____2025-12-06_225450_012.jpg", "audio": "https://res.wx.qq.com/voice/getvoice?mediaid=Mzk4ODcxMjkwOF8yMjQ3NDgzOTMz"},
            {"id": 38, "title": "任何环境不要惧怕", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://r2-gxsongpic.831017.xyz/sheets/1765032875467-p5j2cpqk-_____2025-12-06_225419_494.jpg", "audio": "https://res.wx.qq.com/voice/getvoice?mediaid=MzI5MDY2ODEzOV8yMjQ3NTEwNjcy"},
            {"id": 39, "title": "谷中百合花歌", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://r2-gxsongpic.831017.xyz/sheets/1765032867943-h1dh2xfx-_____2025-12-06_225410_757.jpg", "audio": "https://res.wx.qq.com/voice/getvoice?mediaid=MzkyMDQwMDUxOF8yMjQ3NDg8MDM1"},
            {"id": 40, "title": "宣教的中国", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://r2-gxsongpic.831017.xyz/sheets/1766015712466-zsq0v6x6-457a218e-2451-4712-89da-a6104e74fbbc.png", "audio": "https://res.wx.qq.com/voice/getvoice?mediaid=Mzg5MzQzNjU1OF8yMjQ3NTExMTc2"},
            {"id": 41, "title": "齐来崇拜歌", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://11.400400.icu:9003/api/download/image?id=129721&timestamp=503739974&code=6973", "audio": "https://11.400400.icu:9003/api/download/music?id=84179&timestamp=503740059&code=e017"},
            {"id": 42, "title": "是为了爱", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://11.400400.icu:9003/api/download/image?id=113879&timestamp=503740101&code=8841", "audio": "https://11.400400.icu:9003/api/download/music?id=71165&timestamp=503740116&code=de39"},
            {"id": 43, "title": "我们要赞美耶和华", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://11.400400.icu:9003/api/download/image?id=44844&timestamp=503740144&code=9748", "audio": "https://11.400400.icu:9003/api/download/music?id=32581&timestamp=503740155&code=c0e6"},
            {"id": 44, "title": "如鹰展翅上腾", "artist": "生命灵粮堂", "date": "2026-02", "sheet": "https://11.400400.icu:9003/api/download/image?id=37335&timestamp=504735602&code=749c", "audio": "https://11.400400.icu:9003/api/download/music?id=16131&timestamp=504735614&code=1f7f"},
            {"id": 45, "title": "生命路上歌", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://11.400400.icu:9003/api/download/image?id=126627&timestamp=504735902&code=f9eb", "audio": "https://11.400400.icu:9003/api/download/music?id=81090&timestamp=504735912&code=0985"},
            {"id": 46, "title": "我们欢迎君王降临", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://11.400400.icu:9003/api/download/image?id=123507&timestamp=504735711&code=dd78", "audio": "https://11.400400.icu:9003/api/download/music?id=87177&timestamp=504735718&code=0231"},
            {"id": 47, "title": "医治的爱", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://22.400400.icu:9003/api/download/image?id=121917&timestamp=506642810&code=3e92", "audio": "https://22.400400.icu:9003/api/download/music?id=77676&timestamp=506642835&code=2b56"},
            {"id": 48, "title": "我愿为你去", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://23.400400.icu:9003/api/download/image?id=117671&timestamp=506642901&code=42e3", "audio": "https://23.400400.icu:9003/api/download/music?id=73731&timestamp=506642931&code=190d"},
            {"id": 49, "title": "一生爱你", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://23.400400.icu:9003/api/download/image?id=86690&timestamp=506643035&code=0196", "audio": "https://23.400400.icu:9003/api/download/music?id=51980&timestamp=506643037&code=62da"},
            {"id": 50, "title": "这里有荣耀", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://23.400400.icu:9003/api/download/image?id=133451&timestamp=506643252&code=245f", "audio": "https://23.400400.icu:9003/api/download/music?id=87551&timestamp=506643262&code=bc0d"},
            {"id": 51, "title": "一生一世", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://32.400400.icu:9003/api/download/image?id=118900&timestamp=506643653&code=3425", "audio": "https://32.400400.icu:9003/api/download/music?id=75148&timestamp=506643669&code=ed77"},
            {"id": 52, "title": "主我邀请你", "artist": "小羊诗歌", "date": "2026-02", "sheet": "https://11.400400.icu:9003/api/download/image?id=45116&timestamp=509488392&code=8c98", "audio": "https://11.400400.icu:9003/api/download/music?id=32852&timestamp=509488407&code=1db6"},
            {"id": 53, "title": "我选择喜乐", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://23.400400.icu:9003/api/download/image?id=120713&timestamp=509453145&code=ea35", "audio": "https://23.400400.icu:9003/api/download/music?id=77264&timestamp=509453158&code=65d6"},
            {"id": 54, "title": "祷告", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://33.400400.icu:9003/api/download/image?id=29295&timestamp=509453275&code=c671", "audio": "https://33.400400.icu:9003/api/download/music?id=12613&timestamp=509453284&code=bfd1"},
            {"id": 55, "title": "行神迹的神", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://23.400400.icu:9003/api/download/image?id=86918&timestamp=507638449&code=09c3", "audio": "https://23.400400.icu:9003/api/download/music?id=52039&timestamp=507638466&code=b161"},
            {"id": 56, "title": "你是我的一切", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://34.400400.icu:9003/api/download/image?id=89762&timestamp=507638647&code=14e8", "audio": "https://34.400400.icu:9003/api/download/music?id=62942&timestamp=507638659&code=b61e"},
            {"id": 57, "title": "带我进入你的同在", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://34.400400.icu:9003/api/download/image?id=114176&timestamp=507638566&code=6f55", "audio": "https://34.400400.icu:9003/api/download/music?id=71592&timestamp=507638578&code=c7d4"},
            {"id": 58, "title": "我要看见", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://34.400400.icu:9003/api/download/image?id=86916&timestamp=507638834&code=f92d", "audio": "https://34.400400.icu:9003/api/download/music?id=51733&timestamp=507638838&code=0724"},
            {"id": 59, "title": "十字架", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://34.400400.icu:9003/api/download/image?id=119252&timestamp=507638788&code=4aaf", "audio": "https://34.400400.icu:9003/api/download/music?id=76115&timestamp=507638811&code=84c8"},
            {"id": 60, "title": "你坐着为王 F调", "artist": "生命灵粮堂", "date": "2026-02", "sheet": "https://11.400400.icu:9003/api/download/image?id=112734&timestamp=509562981&code=5e9f", "audio": "https://11.400400.icu:9003/api/download/music?id=70168&timestamp=509562984&code=677c"},
            {"id": 61, "title": "奇异恩典（锁链断开）", "artist": "生命灵粮堂", "date": "2026-02", "sheet": "https://11.400400.icu:9003/api/download/image?id=113951&timestamp=509562914&code=a92e", "audio": "https://11.400400.icu:9003/api/download/music?id=71262&timestamp=509562917&code=add5"},
            {"id": 62, "title": "将天敞开", "artist": "赞美之泉", "date": "2026-02", "sheet": "https://11.400400.icu:9003/api/download/image?id=29516&timestamp=509562805&code=5827", "audio": "https://11.400400.icu:9003/api/download/music?id=12834&timestamp=509562866&code=20ef"}
        ];

        let weeklyIds = JSON.parse(localStorage.getItem('weeklyIds')) || [60, 61, 62];
        let currentSongId = null, isPlaying = false, editingId = null, isShuffle = false, playbackHistory = [];
        const audio = new Audio();

        function save() { localStorage.setItem('worshipLibrary', JSON.stringify(allSongs)); localStorage.setItem('weeklyIds', JSON.stringify(weeklyIds)); }
        function renderAll() { renderHistory(); renderAdminInventory(); renderHomeSetlist(); if (typeof lucide !== 'undefined') lucide.createIcons(); }

        // --- 核心播放控制 ---
        function playSongById(id, recordHistory = true) {
            const song = allSongs.find(s => s.id === id); if(!song) return;
            if (recordHistory && currentSongId !== null && currentSongId !== id) playbackHistory.push(currentSongId);
            currentSongId = id; audio.src = song.audio;
            document.getElementById('play-bar-title').innerText = song.title;
            document.getElementById('display-title').innerText = song.title;
            document.getElementById('hist-playing-title').innerText = song.title;
            document.getElementById('hist-playing-artist').innerText = song.artist;
            renderHomeSetlist(); renderHistory(); togglePlay(true);
        }
        function toggleShuffle() { isShuffle = !isShuffle; const btn = document.getElementById('shuffle-btn'); btn.className = isShuffle ? 'text-white' : 'text-zinc-600'; if (typeof lucide !== 'undefined') lucide.createIcons(); }
        function nextSong() {
            if (isShuffle) playSongById(allSongs[Math.floor(Math.random()*allSongs.length)].id);
            else { const wIdx = weeklyIds.indexOf(currentSongId); if (wIdx !== -1) playSongById(weeklyIds[(wIdx + 1) % weeklyIds.length]); else { const hIdx = allSongs.findIndex(s => s.id === currentSongId); playSongById(allSongs[(hIdx + 1) % allSongs.length].id); } }
        }
        function prevSong() { if (playbackHistory.length > 0) playSongById(playbackHistory.pop(), false); else { const hIdx = allSongs.findIndex(s => s.id === currentSongId); playSongById(allSongs[(hIdx - 1 + allSongs.length) % allSongs.length].id, false); } }

        // --- 页面路由 ---
        function showPage(p) {
            const pHist = document.getElementById('page-history'), pAdm = document.getElementById('page-admin'), pDon = document.getElementById('page-donate');
            if (pHist) pHist.classList.add('translate-y-full'); if (pAdm) pAdm.classList.add('translate-x-full'); if (pDon) pDon.classList.add('translate-y-full');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));

            const donateImg = document.getElementById('donate-img');
            const items = ['donate-tag', 'donate-verse-1', 'donate-verse-2', 'donate-footer'];
            if (donateImg) {
                donateImg.classList.remove('animate-bloom');
                items.forEach(id => { const el = document.getElementById(id); if (el) { el.style.animation = 'none'; el.offsetHeight; el.classList.remove('do-fade-up'); } });
            }

            if(p === 'history') { if (pHist) pHist.classList.remove('translate-y-full'); document.getElementById('nav-history')?.classList.add('active'); renderHistory(); }
            else if(p === 'admin') { if (pAdm) pAdm.classList.remove('translate-x-full'); renderAdminInventory(); }
            else if(p === 'donate') {
                if (pDon) pDon.classList.remove('translate-y-full'); document.getElementById('nav-donate')?.classList.add('active');
                if (donateImg) { setTimeout(() => { donateImg.classList.add('animate-bloom'); items.forEach(id => { const el = document.getElementById(id); if (el) { el.style.animation = ''; el.classList.add('do-fade-up'); } }); }, 300); }
            } else { document.getElementById('nav-home')?.classList.add('active'); }
            if (typeof lucide !== 'undefined') lucide.createIcons();
        }

        // --- 渲染逻辑 ---
        function renderHomeSetlist() {
            const container = document.getElementById('home-weekly-tracks'); if (!container) return;
            container.innerHTML = weeklyIds.map((id, index) => {
                const song = allSongs.find(s => s.id === id); if (!song) return '';
                const active = song.id === currentSongId ? 'border-orange-500 bg-orange-500/10' : '';
                return `<div onclick="playWeeklyByIndex(${index})" class="weekly-track-item group flex items-center justify-between p-4 rounded-xl cursor-pointer ${active}"><div class="flex items-center gap-5 text-left"><span class="text-orange-500/50 font-mono text-xs font-bold">${(index + 1).toString().padStart(2, '0')}</span><div><div class="text-sm font-bold text-white group-hover:text-orange-500 transition-colors">${song.title}</div><div class="text-[10px] text-zinc-500">${song.artist}</div></div></div><i data-lucide="play" class="w-4 h-4 text-white/10 group-hover:text-orange-500 transition-colors"></i></div>`;
            }).join('');
            if (typeof lucide !== 'undefined') lucide.createIcons();
        }

        function renderHistory() {
            const container = document.getElementById('history-sections'), groups = {}, q = document.getElementById('history-search')?.value.toLowerCase() || ""; 
            const filtered = allSongs.filter(s => s.title.toLowerCase().includes(q) || s.artist.toLowerCase().includes(q));
            filtered.forEach(s => { groups[s.date] = groups[s.date] || []; groups[s.date].push(s); });
            container.innerHTML = Object.keys(groups).sort().reverse().map(date => `
                <div class="mb-16 text-left"><div class="flex items-center gap-4 mb-8 text-orange-500 font-bold text-sm tracking-widest uppercase"><span>${date}</span><span class="h-px flex-1 bg-white/5"></span></div><div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6">
                ${groups[date].map(song => {
                    const isPlayingThis = song.id === currentSongId;
                    return `<div onclick="playSongById(${song.id})" class="group relative aspect-[2/3] bg-zinc-900 rounded-lg overflow-hidden cursor-pointer hover:scale-105 transition-all ${isPlayingThis ? 'ring-2 ring-orange-500' : ''}"><img src="${song.sheet}" class="w-full h-full object-cover opacity-20 group-hover:opacity-40 transition-opacity"><div class="absolute inset-0 p-5 flex flex-col justify-end text-white text-left"><div class="text-[10px] text-orange-500 font-bold">${song.artist}</div><div class="text-sm font-bold leading-tight">${song.title}</div></div>${isPlayingThis ? '<div class="absolute top-3 right-3 bg-orange-500 p-1 rounded-full text-white"><i data-lucide="volume-2" class="w-3 h-3"></i></div>' : ''}</div>`;
                }).join('')}</div></div>`).join('');
            if (typeof lucide !== 'undefined') lucide.createIcons();
        }

        function renderAdminInventory() {
            const list = document.getElementById('admin-inventory-list'), q = document.getElementById('admin-search')?.value.toLowerCase() || "";
            const filtered = allSongs.filter(s => s.title.toLowerCase().includes(q) || s.artist.toLowerCase().includes(q));
            list.innerHTML = filtered.map(song => {
                const isSelected = weeklyIds.includes(song.id);
                return `<div class="flex items-center justify-between p-4 rounded-xl border ${isSelected ? 'border-orange-500/50 bg-orange-500/5' : 'border-white/5 bg-zinc-900'} text-white text-left"><div><div class="text-sm font-bold ${isSelected ? 'text-orange-500' : 'text-zinc-300'}">${song.title}</div><div class="text-[10px] text-zinc-500">${song.artist}</div></div><div class="flex gap-2"><button onclick="toggleWeekly(${song.id})" class="p-2 rounded-full ${isSelected ? 'bg-orange-600' : 'bg-zinc-800'}"><i data-lucide="${isSelected ? 'check' : 'plus'}" class="w-4 h-4 text-white"></i></button><button onclick="prepareEdit(${song.id})" class="p-2 rounded-full bg-zinc-800 text-zinc-400 hover:text-white"><i data-lucide="edit-3" class="w-4 h-4"></i></button><button onclick="deleteSong(${song.id})" class="p-2 text-zinc-600 hover:text-red-500 transition-colors"><i data-lucide="trash-2" class="w-4 h-4"></i></button></div></div>`;
            }).join('');
            if (typeof lucide !== 'undefined') lucide.createIcons();
        }

        function prepareEdit(id) {
            const song = allSongs.find(s => s.id === id); if (!song) return;
            editingId = id; document.getElementById('input-title').value = song.title; document.getElementById('input-artist').value = song.artist; document.getElementById('input-sheet').value = song.sheet; document.getElementById('input-audio').value = song.audio;
            document.getElementById('admin-form-title').innerText = "编辑中：" + song.title; document.getElementById('save-btn').innerText = "确认更新"; document.getElementById('cancel-edit-btn').classList.remove('hidden'); window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        function resetAdminForm() { editingId = null; document.querySelectorAll('#page-admin input').forEach(i => i.value = ""); document.getElementById('admin-form-title').innerText = "入库新曲目"; document.getElementById('save-btn').innerText = "确认保存"; document.getElementById('cancel-edit-btn').classList.add('hidden'); }
        function addNewSongToLibrary() {
            const t = document.getElementById('input-title').value, a = document.getElementById('input-artist').value, s = document.getElementById('input-sheet').value, u = document.getElementById('input-audio').value;
            if(!t || !u) return alert("信息缺失");
            if (editingId) { const idx = allSongs.findIndex(x => x.id === editingId); if (idx > -1) allSongs[idx] = { ...allSongs[idx], title: t, artist: a, sheet: s, audio: u }; }
            else { allSongs.unshift({ id: Date.now(), title: t, artist: a, date: new Date().toISOString().slice(0,7), audio: u, sheet: s || "https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?q=80&w=1000" }); }
            save(); renderAll(); resetAdminForm();
        }
        function toggleWeekly(id) { if(weeklyIds.includes(id)) weeklyIds = weeklyIds.filter(i => i !== id); else weeklyIds.push(id); save(); renderAll(); }
        function deleteSong(id) { if(confirm("确定删除？")) { allSongs = allSongs.filter(s => s.id !== id); weeklyIds = weeklyIds.filter(i => i !== id); save(); renderAll(); } }
        function openAdminModal() { document.getElementById('admin-modal')?.classList.remove('hidden'); }
        function closeAdminModal() { document.getElementById('admin-modal')?.classList.add('hidden'); }
        function checkPassword() { if(document.getElementById('admin-password').value === '222221') { closeAdminModal(); showPage('admin'); } else alert("密码错误"); }
        function playWeeklyByIndex(i) { currentIndex = i; playSongById(weeklyIds[i]); }
        function startWeeklyPlay() { if(weeklyIds.length > 0) playSongById(weeklyIds[0]); }
        function showCurrentSheet() {
            const song = allSongs.find(s => s.id === currentSongId) || allSongs[0]; if(!song) return;
            document.getElementById('modal-sheet-img').src = song.sheet; document.getElementById('sheet-modal').classList.remove('hidden');
        }
        function closeSheetModal() { document.getElementById('sheet-modal').classList.add('hidden'); }
        function togglePlay(force = null) {
            isPlaying = force !== null ? force : !isPlaying; const btn = document.getElementById('main-play-btn');
            if(isPlaying) { audio.play().catch(e => {}); btn.innerHTML = '<i data-lucide=\"pause\"></i>'; }
            else { audio.pause(); btn.innerHTML = '<i data-lucide=\"play\"></i>'; }
            if (typeof lucide !== 'undefined') lucide.createIcons();
        }
        audio.ontimeupdate = () => {
            const p = (audio.currentTime / audio.duration) * 100 || 0;
            document.getElementById('progress-bar').value = p; document.getElementById('progress-bar').style.backgroundSize = p + '% 100%';
            document.getElementById('curr-time').innerText = formatTime(audio.currentTime); document.getElementById('total-time').innerText = formatTime(audio.duration);
        };
        document.getElementById('progress-bar').oninput = function() { audio.currentTime = (this.value/100) * audio.duration; };
        document.getElementById('volume-control').oninput = function() { audio.volume = this.value; };
        audio.onended = nextSong;
        function formatTime(s) { if(isNaN(s)) return "00:00"; let m = Math.floor(s/60), sec = Math.floor(s%60); return `${m.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`; }
        renderAll();
    </script>
</body>
</html>